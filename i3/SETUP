#!/bin/bash

if [ ! -e $HOME/.config/device ]; then
  echo "No valid device file!"
  exit 1
fi

device=$(cat $HOME/.config/device)
dotfiles_folder=$HOME/Projects/dotfiles
device_folder=$dotfiles_folder/devices/$device
i3_folder=$dotfiles_folder/i3
device_i3_folder=$device_folder/i3

mkdir -p $HOME/.config/i3

cat $dotfiles_folder/etc/_fileWarning \
  <(echo) $i3_folder/_theme \
  <(echo) $i3_folder/_variables \
  <(echo) $device_i3_folder/_variables \
  <(echo) $i3_folder/_config \
  <(echo) $device_i3_folder/_config \
  <(echo) $i3_folder/_shortcuts \
  <(echo) $device_i3_folder/_shortcuts \
  <(echo) $i3_folder/_modes \
  <(echo) $device_i3_folder/_modes \
  <(echo) $i3_folder/_startup \
  <(echo) $device_i3_folder/_startup \
  <(echo) $i3_folder/_i3bar \
> $HOME/.config/i3/config

cat $dotfiles_folder/etc/_fileWarning \
  <(echo) $i3_folder/_status_theme \
  <(echo) $i3_folder/_status_items \
  <(echo) $device_i3_folder/_status_order \
> $HOME/.config/i3/status.conf

if [ -e $device_i3_folder/_status2_order ]; then
  cat $dotfiles_folder/etc/_fileWarning \
    <(echo) $i3_folder/_status_theme \
    <(echo) $i3_folder/_status_items \
    <(echo) $device_i3_folder/_status2_order \
  > $HOME/.config/i3/status2.conf

  cat <(echo) $i3_folder/_i3bar2 >> $HOME/.config/i3/config
fi

i3-msg restart