#!/bin/zsh
# - https://unix.stackexchange.com/a/565551/456475
## Shows a spinner while another command is running ##
#
# CLI use:
#  spinner sleep 10
#
# To call it within another script you can source it:
#  $(dirname "$0")/spinner.sh
#  sleep 10 & spinner $!
#
# Or prefix known long running commands with an alias:
#  alias rm="spinner rm"

function cleanup() {
  tput cnorm

  echo -en "\033[2K\r"
}
trap cleanup EXIT

function spinner() {
  # make sure we use non-unicode character type locale
  # (that way it works for any locale as long as the font supports the characters)
  local LC_CTYPE=C

  local sid=$1 # Spinner Id to use
  local pid=$2 # Process Id of the previous running command

  case $((${sid} % 33)) in
  0)
    local spin='-\|/'
    local charwidth=1
    ;;
  1)
    local spin="▁▂▃▄▅▆▇█▇▆▅▄▃▂▁"
    local charwidth=3
    ;;
  2)
    local spin="▉▊▋▌▍▎▏▎▍▌▋▊▉"
    local charwidth=1
    ;;
  3)
    local spin='▖▘▝▗'
    local charwidth=3
    ;;
  4)
    local spin='┤┘┴└├┬'
    local charwidth=1
    ;;
  5)
    local spin='◢◣◤◥'
    local charwidth=3
    ;;
  6)
    local spin="●∙∙∙●∙∙∙●∙●∙"
    local charwidth=3
    ;;
  7)
    local spin='╹┗┣╋┳┏╻┓┫╋┻┛'
    local charwidth=1
    ;;
  8)
    local spin="___-\`\`'´-___-´´'\`-"
    local charwidth=1
    ;;
  9)
    local spin='┫┛┻┗┣┏┳┓'
    local charwidth=1
    ;;
  10)
    local spin='╯╰╭╮'
    local charwidth=1
    ;;
  11)
    local spin='╸╹╺╻'
    local charwidth=1
    ;;
  12)
    local spin='▌▀▐▄'
    local charwidth=1
    ;;
  13)
    local spin='╸╹╺╻        '
    local charwidth=1
    ;;
  14)
    local spin=''
    local charwidth=1
    ;;
  15)
    local spin=''
    local charwidth=1
    ;;
  16)
    local spin='◜◠◝◞◟◡◌○◎◷◶◵◵◴◔◑◒◐◓◑◕◉●◕◑◒◐◓◔◎○◌'
    local charwidth=1
    ;;
  17)
    local spin='▁▂▃▄▅▆▇█▉▊▋▌▍▎▏░▒▓▔▖▗▘▙▚▛▜▝▞▟▀█▄▌▐▀'
    local charwidth=1
    ;;
  18)
    local spin=`binaryArray=({0..1}{0..1}{0..1}{0..1}{0..1}{0..1}{0..1}{0..1}) ; printf %s "${binaryArray[@]}" $'\n'`
    local charwidth=8
    ;;
  19)
    local spin="▹▹▹▹▹▸▹▹▹▹▹▸▹▹▹▹▹▸▹▹▹▹▹▸▹▹▹▹▹▸"
    local charwidth=5
    ;;
  20)
    local spin="▰▱▱▱▱▱▱▰▰▱▱▱▱▱▰▰▰▱▱▱▱▰▰▰▰▱▱▱▰▰▰▰▰▱▱▰▰▰▰▰▰▱▰▰▰▰▰▰▰▰▱▱▱▱▱▱"
    local charwidth=7
    ;;
  21)
    local spin="▱▱▱▱▱▱▱▱▱▱▰▱▱▱▱▱▰▰▰▱▱▱▰▰▰▰▰▱▰▰▰▰▰▰▰▱▰▰▰▰▰▱▱▱▰▰▰▱▱▱▱▱▰▱▱▱"
    local charwidth=7
    ;;
  22)
    local spin="▱▱▰▰▰▱▱▱▱▱▰▰▰▱▱▱▱▱▰▰▰▱▱▱▱▱▰▰▱▱▱▱▱▱▰▱▱▱▱▱▰▰▱▱▱▱▰▰▰▱▱▱▰▰▰▱▱▱▰▰▰▱▱▱▰▰▰▱▱▱▰▰▰▱▱▱▱▰▰▱▱▱▱▱▰▱▱▱▱▱▱▰▰▱▱▱▱▱▰▰▰▱▱▱▱▱▰▰▰▱▱▱"
    local charwidth=7
    ;;
  23)
    local spin='⠁⠂⠄⡀⢀⠠⠐⠈'
    local charwidth=1
    ;;
  24)
    local spin="⠁⠂⠄⠂"
    local charwidth=1
    ;;
  25)
    local spin='⣾⣽⣻⢿⡿⣟⣯⣷'
    local charwidth=1
    ;;
  26)
    local spin='⡀⡁⡂⡃⡄⡅⡆⡇⡈⡉⡊⡋⡌⡍⡎⡏⡐⡑⡒⡓⡔⡕⡖⡗⡘⡙⡚⡛⡜⡝⡞⡟⡠⡡⡢⡣⡤⡥⡦⡧⡨⡩⡪⡫⡬⡭⡮⡯⡰⡱⡲⡳⡴⡵⡶⡷⡸⡹⡺⡻⡼⡽⡾⡿⢀⢁⢂⢃⢄⢅⢆⢇⢈⢉⢊⢋⢌⢍⢎⢏⢐⢑⢒⢓⢔⢕⢖⢗⢘⢙⢚⢛⢜⢝⢞⢟⢠⢡⢢⢣⢤⢥⢦⢧⢨⢩⢪⢫⢬⢭⢮⢯⢰⢱⢲⢳⢴⢵⢶⢷⢸⢹⢺⢻⢼⢽⢾⢿⣀⣁⣂⣃⣄⣅⣆⣇⣈⣉⣊⣋⣌⣍⣎⣏⣐⣑⣒⣓⣔⣕⣖⣗⣘⣙⣚⣛⣜⣝⣞⣟⣠⣡⣢⣣⣤⣥⣦⣧⣨⣩⣪⣫⣬⣭⣮⣯⣰⣱⣲⣳⣴⣵⣶⣷⣸⣹⣺⣻⣼⣽⣾⣿'
    local charwidth=1
    ;;
  27)
    local spin="( ●    )(  ●   )(   ●  )(    ● )(     ●)(    ● )(   ●  )(  ●   )( ●    )(●     )"
    local charwidth=8
    ;;
  28)
    local spin="[    ][=   ][==  ][=== ][====][ ===][  ==][   =][    ]"
    local charwidth=6
    ;;
  29)
    local spin="[    ][=   ][==  ][=== ][====][ ===][  ==][   =][    ][   =][  ==][ ===][====][=== ][==  ][=   ]"
    local charwidth=6
    ;;
  30)
    local spin="▁▁▁█████████▁▁█████████▁▁█████████▁▁█████████▁▁█████████▁▁▓████████▁▁▓████████▁▁▒████████▁▁▒████████▁▁░████████▁▁░████████▁▁▁████████▁▁▁████████▁▁▁████████▁▁▁▓███████▁▁▁▓███████▁▁▁▒███████▁▁▁▒███████▁▁▁░███████▁▁▁░███████▁▁▁▁███████▁▁▁▁███████▁▁▁▁███████▁▁▁▁▓██████▁▁▁▁▓██████▁▁▁▁▒██████▁▁▁▁▒██████▁▁▁▁░██████▁▁▁▁░██████▁▁▁▁▁██████▁▁▁▁▁██████▁▁▁▁▁██████▁▁▁▁▁▓█████▁▁▁▁▁▓█████▁▁▁▁▁▒█████▁▁▁▁▁▒█████▁▁▁▁▁░█████▁▁▁▁▁░█████▁▁▁▁▁▁█████▁▁▁▁▁▁█████▁▁▁▁▁▁█████▁▁▁▁▁▁▓████▁▁▁▁▁▁▓████▁▁▁▁▁▁▒████▁▁▁▁▁▁▒████▁▁▁▁▁▁░████▁▁▁▁▁▁░████▁▁▁▁▁▁▁████▁▁▁▁▁▁▁████▁▁▁▁▁▁▁████▁▁▁▁▁▁▁▓███▁▁▁▁▁▁▁▓███▁▁▁▁▁▁▁▒███▁▁▁▁▁▁▁▒███▁▁▁▁▁▁▁░███▁▁▁▁▁▁▁░███▁▁▁▁▁▁▁▁███▁▁▁▁▁▁▁▁███▁▁▁▁▁▁▁▁███▁▁▁▁▁▁▁▁▓██▁▁▁▁▁▁▁▁▓██▁▁▁▁▁▁▁▁▒██▁▁▁▁▁▁▁▁▒██▁▁▁▁▁▁▁▁░██▁▁▁▁▁▁▁▁░██▁▁▁▁▁▁▁▁▁██▁▁▁▁▁▁▁▁▁██▁▁▁▁▁▁▁▁▁██▁▁▁▁▁▁▁▁▁▓█▁▁▁▁▁▁▁▁▁▓█▁▁▁▁▁▁▁▁▁▒█▁▁▁▁▁▁▁▁▁▒█▁▁▁▁▁▁▁▁▁░█▁▁▁▁▁▁▁▁▁░█▁▁▁▁▁▁▁▁▁▁█▁▁▁▁▁▁▁▁▁▁█▁▁▁▁▁▁▁▁▁▁█▁▁▁▁▁▁▁▁▁▁▓▁▁▁▁▁▁▁▁▁▁▓▁▁▁▁▁▁▁▁▁▁▒▁▁▁▁▁▁▁▁▁▁▒▁▁▁▁▁▁▁▁▁▁░▁▁▁▁▁▁▁▁▁▁░▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁‼▁▁▁▁▁▁▁▁▁▁▁‼▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁∞▁▁▁▁▁▁▁▁▁∞▁▁▁▁▁▁▁▁▁▁∞▁▁▁▁▁▁▁▁▁∞▁▁▁▁▁▁▁▁▁▁∞▁▁▁▁▁▁▁▁▁∞▁▁▁▁▁▁▁▁▁∞▁▁▁▁▁▁▁▁▁∞▁▁▁▁▁▁▁▁▁∞▁▁▁▁▁▁▁▁▁∞▁▁▁▁▁▁▁▁▁▁∞▁▁▆▁▁▁▁▁▁▁▁∞▁▁▅▁▁▁▁▁▁▁▁∞▁▁▄▁▁▁▁▁▁▁▁∞▁▁▃▁▁▁▁▁▁▁▁∞▁▁▂▁▁▁▁▁▁▁▁∞▁▁▁▁▁▁▁▁▁▁∞▁▁▁▁▁▁▁▁▁▁∞▁▁▁▁▁▁▁▁▁▁∞▁▁▁▁▁▁▁▁▁▁∞▁▁▁▁▁▁▁▁▁▁∞▁▁▁▁▁▁▁▁▁▁░∞▁▁▁▁▁▁▁▁▁▁▒∞▁▁▁▁▁▁▁▁▁▁▓∞▁▁▁▁▁▁▁▁▁▁█∞▁▁▁▁▁▁▁▁▁▁█░∞▁▁▁▁▁▁▁▁▁█▒∞▁▁▁▁▁▁▁▁▁█▓∞▁▁▁▁▁▁▁▁▁██∞▁▁▁▁▁▁▁▁▁██░∞▁▁▁▁▁▁▁▁██▒∞▁▁▁▁▁▁▁▁██▓∞▁▁▁▁▁▁▁▁███∞▁▁▁▁▁▁▁▁███░∞▁▁▁▁▁▁▁███▒∞▁▁▁▁▁▁▁███▓∞▁▁▁▁▁▁▁████∞▁▁▁▁▁▁▁████░∞▁▁▁▁▁▁████▒∞▁▁▁▁▁▁████▓∞▁▁▁▁▁▁█████∞▁▁▁▁▁▁█████░∞▁▁▁▁▁█████▒∞▁▁▁▁▁█████▓∞▁▁▁▁▁██████∞▁▁▁▁▁██████░∞▁▁▁▁██████▒∞▁▁▁▁██████▓∞▁▁▁▁███████∞▁▁▁▁███████░∞▁▁▁███████▒∞▁▁▁███████▓∞▁▁▁████████∞▁▁▁████████░▁▁▁████████▒▁▁▁████████▓▁▁▁█████████"
    local charwidth=12
    ;;
  31)
    local spin="▐⠂       ▌▐⠈       ▌▐ ⠂      ▌▐ ⠠      ▌▐  ⡀     ▌▐  ⠠     ▌▐   ⠂    ▌▐   ⠈    ▌▐    ⠂   ▌▐    ⠠   ▌▐     ⡀  ▌▐     ⠠  ▌▐      ⠂ ▌▐      ⠈ ▌▐       ⠂▌▐       ⠠▌▐       ⡀▌▐      ⠠ ▌▐      ⠂ ▌▐     ⠈  ▌▐     ⠂  ▌▐    ⠠   ▌▐    ⡀   ▌▐   ⠠    ▌▐   ⠂    ▌▐  ⠈     ▌▐  ⠂     ▌▐ ⠠      ▌▐ ⡀      ▌▐⠠       ▌"
    local charwidth=10
    ;;
  32)
    local spin="█▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██████▁▁▁▁▁▁▁▁▁▁▁▁▁▁██████▁▁▁▁▁▁▁▁▁▁▁▁▁▁███████▁▁▁▁▁▁▁▁▁▁▁▁▁████████▁▁▁▁▁▁▁▁▁▁▁▁█████████▁▁▁▁▁▁▁▁▁▁▁█████████▁▁▁▁▁▁▁▁▁▁▁██████████▁▁▁▁▁▁▁▁▁▁███████████▁▁▁▁▁▁▁▁▁█████████████▁▁▁▁▁▁▁██████████████▁▁▁▁▁▁██████████████▁▁▁▁▁▁▁██████████████▁▁▁▁▁▁██████████████▁▁▁▁▁▁██████████████▁▁▁▁▁▁▁██████████████▁▁▁▁▁▁▁██████████████▁▁▁▁▁▁▁█████████████▁▁▁▁▁▁▁██████████████▁▁▁▁▁▁██████████████▁▁▁▁▁▁▁██████████████▁▁▁▁▁▁██████████████▁▁▁▁▁▁██████████████▁▁▁▁▁▁▁██████████████▁▁▁▁▁▁██████████████▁▁▁▁▁▁▁█████████████▁▁▁▁▁▁▁█████████████▁▁▁▁▁▁▁▁████████████▁▁▁▁▁▁▁▁████████████▁▁▁▁▁▁▁▁▁███████████▁▁▁▁▁▁▁▁▁███████████▁▁▁▁▁▁▁▁▁▁██████████▁▁▁▁▁▁▁▁▁▁██████████▁▁▁▁▁▁▁▁▁▁▁▁████████▁▁▁▁▁▁▁▁▁▁▁▁▁███████▁▁▁▁▁▁▁▁▁▁▁▁▁▁██████▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█████▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██████▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██████▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█████▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██████▁▁▁▁▁▁▁▁▁▁▁▁▁▁███████▁▁▁▁▁▁▁▁▁▁▁▁▁▁███████▁▁▁▁▁▁▁▁▁▁▁▁▁▁██████▁▁▁▁▁▁▁▁▁▁▁▁▁▁███████▁▁▁▁▁▁▁▁▁▁▁▁▁█████████▁▁▁▁▁▁▁▁▁▁▁▁█████████▁▁▁▁▁▁▁▁▁▁▁█████████▁▁▁▁▁▁▁▁▁▁▁█████████▁▁▁▁▁▁▁▁▁▁▁█████████▁▁▁▁▁▁▁▁▁▁▁███████████▁▁▁▁▁▁▁▁▁████████████▁▁▁▁▁▁▁▁████████████▁▁▁▁▁▁▁▁██████████████▁▁▁▁▁▁██████████████▁▁▁▁▁▁▁██████████████▁▁▁▁▁▁██████████████▁▁▁▁▁▁▁▁█████████████▁▁▁▁▁▁▁▁▁████████████▁▁▁▁▁▁▁▁████████████▁▁▁▁▁▁▁▁▁███████████▁▁▁▁▁▁▁▁▁▁▁█████████▁▁▁▁▁▁▁▁▁▁▁█████████▁▁▁▁▁▁▁▁▁▁▁▁█████████▁▁▁▁▁▁▁▁▁▁▁█████████▁▁▁▁▁▁▁▁▁▁▁▁█████████▁▁▁▁▁▁▁▁▁▁▁▁████████▁▁▁▁▁▁▁▁▁▁▁▁████████▁▁▁▁▁▁▁▁▁▁▁▁▁███████▁▁▁▁▁▁▁▁▁▁▁▁▁███████▁▁▁▁▁▁▁▁▁▁▁▁▁▁███████▁▁▁▁▁▁▁▁▁▁▁▁▁███████▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█████▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁"
    local charwidth=20
    ;;
  esac

  tput civis # cursor invisible

  local i=0
  while kill -0 $pid 2>/dev/null; do
    local i=$(((i + $charwidth) % ${#spin}))
    echo -en "\r"
    # tput cub1
    printf "%s" "${spin:$i:$charwidth}"

    sleep .1
  done

  cleanup

  wait $pid # capture exit code

  return $?
}

("$@") &

spinner "${SPINNER:-"$RANDOM"}" $!